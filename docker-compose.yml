# Docker Compose配置文件，定义项目的多容器部署结构
# 本文件定义了三个主要服务：pyllm（LLM服务）、gateway（API网关）和web（前端应用）
services:
  # pyllm服务：Python实现的大语言模型服务
  pyllm:
    build:  # 构建配置
      context: ./services/pyllm  # 构建上下文目录
    environment:  # 环境变量配置
      - OPENAI_API_KEY  # 从宿主机传递OPENAI_API_KEY环境变量
    volumes:  # 数据卷配置
      - pyllm_data:/app/data  # 将pyllm_data卷挂载到容器的/app/data目录，用于持久化数据
    ports:  # 端口映射
      - "8000:8000"  # 将宿主机的8000端口映射到容器的8000端口

  # gateway服务：Go实现的API网关服务
  gateway:
    build:  # 构建配置
      context: ./services/gateway  # 构建上下文目录
    environment:  # 环境变量配置
      - PY_SERVICE_URL=http://pyllm:8000  # 配置Python服务的URL，用于网关转发请求
    depends_on:  # 依赖关系
      - pyllm  # 依赖pyllm服务，确保pyllm先启动
    ports:  # 端口映射
      - "8080:8080"  # 将宿主机的8080端口映射到容器的8080端口

  # web服务：前端应用服务
  web:
    build:  # 构建配置
      context: ./apps/web  # 构建上下文目录
    depends_on:  # 依赖关系
      - gateway  # 依赖gateway服务，确保gateway先启动
    ports:  # 端口映射
      - "3000:80"  # 将宿主机的3000端口映射到容器的80端口

# 数据卷定义
volumes:
  pyllm_data:  # 定义pyllm_data数据卷，用于持久化pyllm服务的数据

